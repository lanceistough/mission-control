<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mission Control</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Password Protection -->
  <div id="password-overlay">
    <div class="password-box">
      <h2>MISSION CONTROL</h2>
      <input type="password" id="pass-input" class="password-input" placeholder="Enter Password">
      <button onclick="checkPass()" class="btn">Login</button>
    </div>
  </div>

  <div id="main-content" style="display:none">
    <div class="container">
      <header class="header">
        <div class="status-section">
          <div id="status-light" class="status-light idle"></div>
          <span id="status-text" class="status-text">IDLE</span>
        </div>
        <h1 class="title">CLEO OPS</h1>
      </header>

      <div class="columns-container">
        <!-- Column 1: Queue -->
        <div class="column glass-card">
          <span class="section-title">Queue</span>
          <div id="queue-list" class="task-list"></div>
          <div id="queue-empty" class="empty-msg">No tasks queued</div>
        </div>

        <!-- Column 2: Active -->
        <div class="column glass-card">
          <span class="section-title">Active</span>
          <div id="active-list" class="task-list"></div>
          <div id="active-empty" class="empty-msg">System idle</div>
        </div>

        <!-- Column 3: Completed -->
        <div class="column glass-card">
          <span class="section-title">Completed</span>
          <div id="completed-list" class="task-list"></div>
          <div id="completed-empty" class="empty-msg">No tasks finished</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const GIST_URL = 'https://gist.githubusercontent.com/lanceistough/a7175de1aa3a9f9dfce5f71806239bfd/raw';
    const PASS_HASH = 'GrandpaLeo23!'; // Plaintext check for simplicity as requested

    function checkPass() {
      const input = document.getElementById('pass-input').value;
      if (input === PASS_HASH) {
        localStorage.setItem('mc_auth', 'true');
        showDashboard();
      } else {
        alert('Access Denied');
      }
    }

    function showDashboard() {
      document.getElementById('password-overlay').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
      loadState();
      setInterval(loadState, 10000);
    }

    if (localStorage.getItem('mc_auth') === 'true') {
      showDashboard();
    }

    async function loadState() {
      try {
        const resp = await fetch(GIST_URL + '?t=' + Date.now());
        const state = await resp.json();
        
        // Update Status
        document.getElementById('status-light').className = 'status-light ' + (state.status || 'idle');
        document.getElementById('status-text').textContent = (state.status || 'idle').toUpperCase();
        
        // Helper to render lists
        const renderList = (elId, emptyId, items) => {
          const el = document.getElementById(elId);
          const empty = document.getElementById(emptyId);
          el.innerHTML = '';
          if (items && items.length > 0) {
            empty.style.display = 'none';
            items.forEach(item => {
              const div = document.createElement('div');
              div.className = 'task-item';
              div.textContent = typeof item === 'string' ? item : item.text;
              el.appendChild(div);
            });
          } else {
            empty.style.display = 'block';
          }
        };

        // We use the 'todos' field from gist to populate these columns
        // Logic: 
        // 1. completed: true -> Completed
        // 2. active: true or in 'currentTask' -> Active
        // 3. others -> Queue
        
        const todos = state.todos || [];
        const completed = todos.filter(t => t.completed);
        const active = [];
        if (state.currentTask) active.push({text: state.currentTask});
        const queue = todos.filter(t => !t.completed);

        renderList('queue-list', 'queue-empty', queue);
        renderList('active-list', 'active-empty', active);
        renderList('completed-list', 'completed-empty', completed);

      } catch (e) {
        console.error('State load failed', e);
      }
    }
  </script>
</body>
</html>
